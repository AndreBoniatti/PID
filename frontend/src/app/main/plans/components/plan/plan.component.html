<div class="m-3">
  <div class="activity-container">
    <span class="activity-info"
      >CH do Usuário: <strong>{{ userWorkload }}</strong></span
    >
    <span class="activity-info"
      >CH Restante: <strong>{{ getWorkloadRemaining() }}</strong></span
    >

    <div>
      <button
        mat-raised-button
        class="cancel-submit-button"
        *ngIf="planIsSent()"
        (click)="cancelPlanSubmission()"
      >
        <mat-icon>cancel_schedule_send</mat-icon>Cancelar Submissão
      </button>

      <button
        mat-raised-button
        class="submit-button"
        *ngIf="planIsPending()"
        [disabled]="getWorkloadRemaining() !== 0"
        (click)="submitPlan()"
      >
        <mat-icon>send</mat-icon>Submeter
      </button>

      <button
        mat-raised-button
        [disabled]="!planIsPending() && plan"
        (click)="openActivityDialog()"
      >
        <mat-icon>add</mat-icon>Adicionar Atividade
      </button>
    </div>
  </div>

  <div class="mat-elevation-z8 mt-3">
    <div class="activities-table">
      <table mat-table class="mat-table" [dataSource]="dataSource">
        <ng-container matColumnDef="description">
          <th mat-header-cell class="mat-header-cell" *matHeaderCellDef>
            Atividade
          </th>
          <td mat-cell class="mat-cell" *matCellDef="let row">
            {{ row.description }}
          </td>
        </ng-container>

        <ng-container matColumnDef="activityType">
          <th mat-header-cell class="mat-header-cell" *matHeaderCellDef>
            Tipo
          </th>
          <td mat-cell class="mat-cell" *matCellDef="let row">
            {{ row.activityType?.description }}
          </td>
        </ng-container>

        <ng-container matColumnDef="workload">
          <th mat-header-cell class="mat-header-cell" *matHeaderCellDef>CH</th>
          <td mat-cell class="mat-cell" *matCellDef="let row">
            {{ row.workload }}
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell class="mat-header-cell" *matHeaderCellDef>
            Ações
          </th>
          <td mat-cell class="mat-cell" *matCellDef="let row">
            <button
              mat-icon-button
              [disabled]="!planIsPending()"
              (click)="openActivityDialog(row)"
            >
              <mat-icon>edit</mat-icon>
            </button>
            <button
              mat-icon-button
              [disabled]="!planIsPending()"
              (click)="deleteActivity(row)"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr
          mat-header-row
          class="mat-header-row"
          *matHeaderRowDef="displayedColumns"
        ></tr>
        <tr
          mat-row
          class="mat-row"
          *matRowDef="let row; columns: displayedColumns"
        ></tr>

        <tr *matNoDataRow>
          <td class="mat-cell" colspan="4">Nenhum registro encontrado</td>
        </tr>
      </table>
    </div>
  </div>

  <div *ngIf="plan?.activities?.length ?? 0 > 0">
    <div class="print-container mt-4">
      <button mat-raised-button (click)="getWorkloadAllocationReport()">
        <mat-icon>print</mat-icon> Imprimir
      </button>
    </div>

    <div class="mt-3 pb-3">
      <app-workload-allocation
        #workloadAllocation
        [readonlyMode]="true"
      ></app-workload-allocation>
    </div>
  </div>
</div>
